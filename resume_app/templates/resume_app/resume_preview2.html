<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <title>{{ resume.full_name }} - Resume</title>
    <link rel="stylesheet" href="{% static 'job_app/css/resume_preview2.css' %}">
    <link rel="stylesheet" href="{% static 'job_app/css/style.css' %}">
</head>
<style>
    #resume {
  width: 210mm;
  min-height: 297mm;
  padding: 10mm;
  margin: 0;              /* make sure no top margin */
  background: white;
  box-sizing: border-box;
}
</style>
<body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<div class="resume-wrapper", id="resume">

    <!-- Header -->
    <header class="resume-header">
        <h1 class="name">{{ resume.full_name }}</h1>
        <p class="contact">
            {{ resume.address }} | {{ resume.phone }} | {{ resume.email }}
            {% if resume.linkedin %} | <a href="{{ resume.linkedin }}">LinkedIn</a>{% endif %}
            {% if resume.github %} | <a href="{{ resume.github }}">GitHub</a>{% endif %}
            {% if resume.portfolio %} | <a href="{{ resume.portfolio }}">Portfolio</a>{% endif %}
        </p>
    </header>

    <!-- Experience -->
    <section class="section">
        <h2>Experience</h2>
        {% for exp in experience %}
            <div class="item">
                <h3>{{ exp.role }}</h3>
                <p><em>{{ exp.company }}</em> | {{ exp.duration }}</p>
                <p>{{ exp.description }}</p>
            </div>
        {% empty %}
            <p>No experience added.</p>
        {% endfor %}
    </section>

    <!-- Skills -->
    <section class="section">
        <h2>Skills</h2>
        <p>
        {% for skill in skills %}
            {{ skill.skill }}{% if not forloop.last %}, {% endif %}
        {% empty %}
            No skills added.
        {% endfor %}
        </p>
    </section>

    <!-- Education -->
    <section class="section">
        <h2>Education</h2>
        {% for edu in education %}
            <p><strong>{{ edu.degree }}</strong> – {{ edu.university }} ({{ edu.year }}) | {{ edu.grade }}</p>
        {% empty %}
            <p>No education added.</p>
        {% endfor %}
    </section>

    <!-- Certifications -->
    <section class="section">
        <h2>Certifications</h2>
        {% for cer in certifications %}
            <p><strong>{{ cer.name }}</strong> – {{ cer.organization }} ({{ cer.issue_date|date:"Y" }})</p>
        {% empty %}
            <p>No certifications added.</p>
        {% endfor %}
    </section>

    <!-- Achievements -->
    <section class="section">
        <h2>Achievements</h2>
        <ul>
        {% for ach in achievements %}
            <li>{{ ach.title }} – {{ ach.description }}</li>
        {% empty %}
            <li>No achievements added.</li>
        {% endfor %}
        </ul>
    </section>

    <!-- Publications -->
    <section class="section">
        <h2>Publications</h2>
        <ul>
        {% for pub in publications %}
            <li><strong>{{ pub.title }}</strong> – {{ pub.journal }} ({{ pub.date|date:"Y" }})</li>
        {% empty %}
            <li>No publications added.</li>
        {% endfor %}
        </ul>
    </section>

    <!-- Languages -->
    <section class="section">
        <h2>Languages</h2>
        <ul>
        {% for lan in languages %}
            <li>{{ lan.language }} ({{ lan.proficiency }})</li>
        {% empty %}
            <li>No languages added.</li>
        {% endfor %}
        </ul>
    </section>

</div>
<!-- Download button -->
<div class="text-center mt-4" style="padding-top: 2%;">
    <button class="btn btn-primary" onclick="downloadResume()">Download Resume as PDF</button>
</div>


<script>
function downloadResume() {
  const element = document.getElementById("resume");
  html2pdf()
    .set({
      margin: 0,
      filename: '{{ resume.full_name|default:"My_Resume" }}.pdf',
      html2canvas: { scale: 2, useCORS: true,scrollY:0 },
      jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
    })
    .from(element)
    .save();
}
</script>
</body>
</html>
