
<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    {% load crispy_forms_tags %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/community_home.css' %}">
    <title>Community</title>
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"></script>

</head>

<style>

@media(max-width:768px){
    .create-post-fixed form textarea {
    height: 50px;
    padding: 10px 15px;
    resize: vertical;
    width: 156%;
    position: relative;
    left: 14%;
}
.create-post-form .post-btn {
    border-radius: 25px;
    padding: 10px 20px;
    background-color: #0d6efd;
    border: none;
    color: #fff;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.3s;
    position: relative;
    left: 16.5%;
    top: 8px;
    width: 28%;
    height: 41px;
    font-size: 18px;
}
.posts-list {
    display: flex;
    flex-direction: column;
    gap: 5px;
    width: 330px;
    padding-bottom: 65px;
}
}

</style>
<body>

        <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: rgba(18, 18, 18, 0.7);">
      <a class="navbar-brand" href="#">JobPortal</a>

      <!-- Mobile Toggle -->
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarContent">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Navbar Content -->
      <div class="collapse navbar-collapse" id="navbarContent">
        <!-- Left Links -->
        <ul class="navbar-nav mr-auto">
          <li class="nav-item"><a class="nav-link" href="{% url 'home' %}">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="/list/">Jobs</a></li>
          <li class="nav-item"><a class="nav-link" href="/about/">About</a></li>
          <li class="nav-item"><a class="nav-link" href="/contact/">Contact</a></li>
          <li class="nav-item"><a class="nav-link" href="/emp_pj/">Employers/Post Job</a></li>
        </ul>

        <!-- Right Buttons -->
        <div class="form-inline my-2 my-lg-0">
          <!-- <a href="/login/" class="btn btn-outline-light mr-2">User Login</a> -->
          <a href="/register/" class="btn btn-light" st>Register</a>
          {% if user.is_authenticated %}
              <div class="profile-icon">
                  <a href="{% url 'dashboard' %}">
                      {% if profile and profile.profile_picture %}
                          <img src="{{ profile.profile_picture.url }}" 
                               alt="Profile Picture"
                               class="rounded-circle"
                               style="width:50px; height:50px; object-fit: cover; border: 2px solid #fff;">
                      {% else %}
                          
                          <img src="{% static 'images/user.png' %}" 
                               alt="Profile"
                               style="width:40px; height:40px; border-radius:50%; background:white; padding:5px;">
                      {% endif %}
                  </a>
              </div>
          {% else %}
              <button type="button" class="btn btn-outline-light" data-toggle="modal" data-target="#loginModal">
                  Login
              </button>
          {% endif %}


        </div>
      </div>
    </nav>

<div class="community-container">

    <!-- Header -->
    <div class="community-header">
        <h2>üåê Community</h2>
    </div>

    <!-- Posts List -->
    <div class="posts-list">
        {% for post in posts %}
        <div class="post-card">
            <div class="post-header">
                <div class="post-user">
                    <a href="{% url 'dashboard' %}">
                        {% if post.user.detail and post.user.detail.profile_picture %}
                            <img src="{{ post.user.detail.profile_picture.url }}" 
                                 alt="{{ post.user.username }}" class="profile-pic">
                        {% else %}
                            <img src="{% static 'images/user.png' %}" 
                                 alt="Default Avatar" class="profile-pic">
                        {% endif %}
                    </a>
                    <span class="username">{{ post.user.username }}</span>
                </div>
                <span class="post-date">{{ post.created_at|date:"M d, Y H:i" }}</span>
            </div>

            <h3 class="post-title">{{ post.title }}</h3>
            <p class="post-content">{{ post.content|truncatewords:25 }}</p>

            <div class="post-footer">
                <span class="post-category">
                    {% if post.category == "discussion" %} üí¨ Discussion {% else %} üì∞ Article {% endif %}
                </span>
                <span class="post-comments">üí¨ {{ post.comments.count }}</span>
                <a href="{% url 'post_detail' post.id %}" class="btn btn-sm btn-outline-light">Read More</a>
            </div>
        </div>
        {% empty %}
            <p class="no-posts">No posts yet ‚Äî start the conversation!</p>
        {% endfor %}
    </div>

    <!-- Sticky Create Post Form -->
{% if user.is_authenticated %}
<div class="create-post-fixed" sty>
    <form method="post" class="create-post-form" style="position: relative; right: 14%;">
        {% csrf_token %}
        {{ form.content|as_crispy_field }}
        
        {% if form.category %}
        {{ form.category|as_crispy_field }}
        {% endif %}
        
        <button type="submit" class="btn btn-primary post-btn">üìÆ POST</button>
        
    </form>
</div>
{% else %}
<p class="login-msg">Login to create a post</p>
{% endif %}


</div>
</body>
</html>
